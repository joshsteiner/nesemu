emu.speedmode("normal")

local instrlen = {
  [0x00] = 0, [0x01] = 1, [0x04] = 1, [0x05] = 1, [0x06] = 1, [0x08] = 0,
  [0x09] = 1, [0x0A] = 0, [0x0C] = 2, [0x0D] = 2, [0x0E] = 2, [0x10] = 1,
  [0x11] = 1, [0x14] = 1, [0x15] = 1, [0x16] = 1, [0x18] = 0, [0x19] = 2,
  [0x1A] = 0, [0x1C] = 2, [0x1D] = 2, [0x1E] = 2, [0x20] = 2, [0x21] = 1,
  [0x24] = 1, [0x25] = 1, [0x26] = 1, [0x28] = 0, [0x29] = 1, [0x2A] = 0,
  [0x2C] = 2, [0x2D] = 2, [0x2E] = 2, [0x30] = 1, [0x31] = 1, [0x34] = 1,
  [0x35] = 1, [0x36] = 1, [0x38] = 0, [0x39] = 2, [0x3A] = 0, [0x3C] = 2,
  [0x3D] = 2, [0x3E] = 2, [0x40] = 0, [0x41] = 1, [0x44] = 1, [0x45] = 1,
  [0x46] = 1, [0x48] = 0, [0x49] = 1, [0x4A] = 0, [0x4C] = 2, [0x4D] = 2,
  [0x4E] = 2, [0x50] = 1, [0x51] = 1, [0x54] = 1, [0x55] = 1, [0x56] = 1,
  [0x58] = 0, [0x59] = 2, [0x5A] = 0, [0x5C] = 2, [0x5D] = 2, [0x5E] = 2,
  [0x60] = 0, [0x61] = 1, [0x64] = 1, [0x65] = 1, [0x66] = 1, [0x68] = 0,
  [0x69] = 1, [0x6A] = 0, [0x6C] = 2, [0x6D] = 2, [0x6E] = 2, [0x70] = 1,
  [0x71] = 1, [0x74] = 1, [0x75] = 1, [0x76] = 1, [0x78] = 0, [0x79] = 2,
  [0x7A] = 0, [0x7C] = 2, [0x7D] = 2, [0x7E] = 2, [0x80] = 1, [0x81] = 1,
  [0x82] = 1, [0x84] = 1, [0x85] = 1, [0x86] = 1, [0x88] = 0, [0x89] = 1,
  [0x8A] = 0, [0x8C] = 2, [0x8D] = 2, [0x8E] = 2, [0x90] = 1, [0x91] = 1,
  [0x94] = 1, [0x95] = 1, [0x96] = 1, [0x98] = 0, [0x99] = 2, [0x9A] = 0,
  [0x9D] = 2, [0xA0] = 1, [0xA1] = 1, [0xA2] = 1, [0xA4] = 1, [0xA5] = 1,
  [0xA6] = 1, [0xA8] = 0, [0xA9] = 1, [0xAA] = 0, [0xAC] = 2, [0xAD] = 2,
  [0xAE] = 2, [0xB0] = 1, [0xB1] = 1, [0xB4] = 1, [0xB5] = 1, [0xB6] = 1,
  [0xB8] = 0, [0xB9] = 2, [0xBA] = 0, [0xBC] = 2, [0xBD] = 2, [0xBE] = 2,
  [0xC0] = 1, [0xC1] = 1, [0xC2] = 1, [0xC4] = 1, [0xC5] = 1, [0xC6] = 1,
  [0xC8] = 0, [0xC9] = 1, [0xCA] = 0, [0xCC] = 2, [0xCD] = 2, [0xCE] = 2,
  [0xD0] = 1, [0xD1] = 1, [0xD4] = 1, [0xD5] = 1, [0xD6] = 1, [0xD8] = 0,
  [0xD9] = 2, [0xDA] = 0, [0xDC] = 2, [0xDD] = 2, [0xDE] = 2, [0xE0] = 1,
  [0xE1] = 1, [0xE2] = 1, [0xE4] = 1, [0xE5] = 1, [0xE6] = 1, [0xE8] = 0,
  [0xE9] = 1, [0xEA] = 0, [0xEC] = 2, [0xED] = 2, [0xEE] = 2, [0xF0] = 1,
  [0xF1] = 1, [0xF4] = 1, [0xF5] = 1, [0xF6] = 1, [0xF8] = 0, [0xF9] = 2,
  [0xFA] = 0, [0xFC] = 2, [0xFD] = 2, [0xFE] = 2
}

function getinstruction(pc)
  local instr = "["
  local ilen = instrlen[memory.readbyte(pc)]
  for i = 0, ilen do
    instr = instr .. string.format("%02X ", memory.readbyte(pc + i))
  end
  instr = instr .. "]"
  return instr
end

-- emu.setrenderplanes(true, true)

for _ = 0, 100 do
  local pc = memory.getregister("pc")
  local instr = getinstruction(pc)
  local a = memory.getregister("a")
  local x = memory.getregister("x")
  local y = memory.getregister("y")
  local p = memory.getregister("p")
  local s = memory.getregister("s")
  io.write(string.format("%04X %s %02X %02X %02X %02X %02X\n", pc, instr, a, x, y, p, s))
  emu.frameadvance()
end

os.exit()
